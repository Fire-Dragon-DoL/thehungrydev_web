<!DOCTYPE html> <html lang=en class=thehungrydev> <head> <meta http-equiv=X-UA-Compatible content="IE=edge;chrome=1"/> <meta charset=utf-8 /> <meta name=apple-mobile-web-app-capable content=yes /> <meta name=apple-mobile-web-app-status-bar-style content=black /> <meta name=apple-mobile-web-app-title content=website_title /> <meta name=viewport content="width=device-width, initial-scale=1"/> <meta name=description content="TheHungryDev website"/> <title> Example Article | The Hungry Dev </title> <link rel=alternate type="application/atom+xml" title="Atom Feed" href="/blog/feed.xml"/> <link href="../../../stylesheets/application-a29382ed.css" rel=stylesheet /> </head> <body> <div id=main> <header> <h1 class=blogheader> <span class=bigheader-title> The Hungry Dev Blog </span> <hr class="pagesplitter pagesplitter--header-top"> <div class="blogheader-content blogheader-content--with-linkflag"> <a href="/" class="link--undecorated blogheader-content__home-link"> <img alt="The Hungry Dev Blog" class="fluidimage fluidimage-header-blog blogheader-content__home-image" width=1724 height=405 src="../../../images/blog-title-ef9fb86b.png"/> </a><div class="linkflag background-dark"> <div> <i class=linkflag__angle></i> <a href="/blog"><img alt=Blog class=linkflag-icon width=375 height=326 src="../../../images/icons/blog--big-aafd7255.png"/></a> </div> </div> </div> <hr class="pagesplitter pagesplitter--header-bottom-blog"> <div class=blogheader-links> <div class=blogheader-links__icons> <a href="/blog"><img alt=Blog class=blogheaders-link-icon width=375 height=326 src="../../../images/icons/blog--big-aafd7255.png"/></a> </div> <hr class="pagesplitter pagesplitter--header-bottom-links"> </div> </h1> </header> <div class=blogbody> <div class=blogbody__body> <article class="blogbody__column-content blogbody__column-content--full article"> <div class=blogbody__content-item> <header class="article__section article__section--always-readable article__header"> <h2 class=article__title> Example Article </h2> <address class=article__author> by <a rel=author href="//thehungry.dev" class=link--undecorated> Francesco Belladonna </a> </address> <time datetime="2013-01-06T00:00:00.000-08:00" class=article__pubdate>January 6, 2013</time> </header> <div class="article__section article__section--always-readable article__body"> <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Vivamus bibendum mauris ante, id vestibulum arcu viverra sed. Ut a libero vitae tellus porttitor porta. Cum sociis natoque penatibus et magnis dis parturient montes, nascetur ridiculus mus.</p> <p></p> <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Vivamus bibendum mauris ante, id vestibulum arcu viverra sed. Ut a libero vitae tellus porttitor porta. Cum sociis natoque penatibus et magnis dis parturient montes, nascetur ridiculus mus.</p> <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Vivamus bibendum mauris ante, id vestibulum arcu viverra sed. Ut a libero vitae tellus porttitor porta. Cum sociis natoque penatibus et magnis dis parturient montes, nascetur ridiculus mus.</p> <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Vivamus bibendum mauris ante, id vestibulum arcu viverra sed. Ut a libero vitae tellus porttitor porta. Cum sociis natoque penatibus et magnis dis parturient montes, nascetur ridiculus mus.</p> <p>This is an example article. You probably want to delete it and write your own articles!</p> <ul> <li>WTF</li> <li>is this</li> </ul> <div class="highlight ruby"><table style="border-spacing: 0"><tbody><tr><td class="gutter gl" style="text-align: right"><pre class=lineno>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102</pre></td><td class=code><pre><span class="nb">require</span> <span class="s2">"carb"</span>
<span class="nb">require</span> <span class="s2">"carb/container/base"</span>
<span class="nb">require</span> <span class="s2">"carb/container/already_registered_error"</span>
<span class="nb">require</span> <span class="s2">"carb/container/dependency_missing_error"</span>

<span class="k">module</span> <span class="nn">Carb::Container</span>
  <span class="kp">include</span> <span class="o">::</span><span class="no">Carb</span><span class="o">::</span><span class="no">Container</span><span class="o">::</span><span class="no">Base</span>

  <span class="c1"># Simple {Hash} based container for dependency resolution based on name, with</span>
  <span class="c1"># further registration capabilities</span>
  <span class="k">class</span> <span class="nc">RegistryContainer</span>
    <span class="kp">include</span> <span class="o">::</span><span class="no">Carb</span><span class="o">::</span><span class="no">Container</span><span class="o">::</span><span class="no">Base</span>

    <span class="no">Record</span> <span class="o">=</span> <span class="no">Struct</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="ss">:dependency</span><span class="p">,</span> <span class="ss">:registerer</span><span class="p">)</span>

    <span class="kp">private</span>

    <span class="kp">attr_reader</span> <span class="ss">:dependencies</span>

    <span class="kp">public</span>

    <span class="c1"># @param dependencies [Hash{Object =&gt; Proc}] dependency name with proc</span>
    <span class="c1">#   as value, which will be `call`ed to extract the dependency object extract the dependency object extract the dependency object extract the dependency object extract the dependency object extract the dependency object extract the dependency object extract the dependency object</span>
    <span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">dependencies</span> <span class="o">=</span> <span class="p">{})</span>
      <span class="vi">@dependencies</span> <span class="o">=</span> <span class="p">{}</span>
      <span class="n">dependencies</span><span class="p">.</span><span class="nf">each</span> <span class="k">do</span> <span class="o">|</span><span class="nb">name</span><span class="p">,</span> <span class="n">dep</span><span class="o">|</span>
        <span class="n">register_with_caller</span><span class="p">(</span><span class="nb">name</span><span class="p">,</span> <span class="n">dep</span><span class="p">,</span> <span class="n">caller_locations</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
      <span class="k">end</span>
    <span class="k">end</span>

    <span class="c1"># @param name [Object] name used to fetch back the dependency</span>
    <span class="c1"># @param dependency [Proc] dependency to be stored, must be wrapped within</span>
    <span class="c1">#   a lambda</span>
    <span class="c1"># @raise [TypeError] raised if dependency is not a {Proc}</span>
    <span class="c1"># @raise [AlreadyRegisteredError] raise when a dependency with same name</span>
    <span class="c1">#   already exists</span>
    <span class="c1"># @return [RegistryContainer] self (for chaining purposes)</span>
    <span class="k">def</span> <span class="nf">register</span><span class="p">(</span><span class="nb">name</span><span class="p">,</span> <span class="n">dependency</span><span class="p">)</span>
      <span class="n">register_with_caller</span><span class="p">(</span><span class="nb">name</span><span class="p">,</span> <span class="n">dependency</span><span class="p">,</span> <span class="n">caller_locations</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
      <span class="nb">self</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">let_there_be_numbers</span>
      <span class="mi">123</span> <span class="o">+</span> <span class="mi">100_000</span> <span class="o">+</span> <span class="mi">3</span><span class="o">.</span><span class="mi">0</span> <span class="o">+</span> <span class="mh">0x234</span>
    <span class="k">end</span>

    <span class="c1"># Gets a dependency</span>
    <span class="c1"># @param name [Object] dependency name with which it was registered</span>
    <span class="c1"># @return [nil, Object] nil if dependency is missing, otherwise the</span>
    <span class="c1">#   dependency, unwrapped from proc</span>
    <span class="k">def</span> <span class="nf">[]</span><span class="p">(</span><span class="nb">name</span><span class="p">)</span>
      <span class="n">ensure_dependency_present!</span><span class="p">(</span><span class="nb">name</span><span class="p">)</span>

      <span class="n">dependencies</span><span class="p">[</span><span class="nb">name</span><span class="p">].</span><span class="nf">dependency</span><span class="o">.</span><span class="p">()</span>
    <span class="k">end</span>

    <span class="c1"># Checks if the dependency exists within the container</span>
    <span class="c1"># @param name [Object] dependency name with which it was registered</span>
    <span class="c1"># @return [Boolean] true if the dependency exists within the container,</span>
    <span class="c1">#   false otherwise</span>
    <span class="k">def</span> <span class="nf">has_key?</span><span class="p">(</span><span class="nb">name</span><span class="p">)</span>
      <span class="n">dependencies</span><span class="p">.</span><span class="nf">has_key?</span><span class="p">(</span><span class="nb">name</span><span class="p">)</span>
    <span class="k">end</span>

    <span class="kp">private</span>

    <span class="k">def</span> <span class="nf">register_with_caller</span><span class="p">(</span><span class="nb">name</span><span class="p">,</span> <span class="n">dependency</span><span class="p">,</span> <span class="n">registerer</span><span class="p">)</span>
      <span class="n">ensure_dependency_type!</span><span class="p">(</span><span class="n">dependency</span><span class="p">)</span>
      <span class="n">ensure_dependency_uniqueness!</span><span class="p">(</span><span class="nb">name</span><span class="p">)</span>

      <span class="n">dependencies</span><span class="p">[</span><span class="nb">name</span><span class="p">]</span> <span class="o">=</span> <span class="no">Record</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="n">dependency</span><span class="p">,</span> <span class="n">registerer</span><span class="p">)</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">ensure_dependency_present!</span><span class="p">(</span><span class="nb">name</span><span class="p">)</span>
      <span class="k">return</span> <span class="k">if</span> <span class="n">has_key?</span><span class="p">(</span><span class="nb">name</span><span class="p">)</span>

      <span class="k">raise</span> <span class="no">DependencyMissingError</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="nb">name</span><span class="p">),</span> <span class="n">missing</span><span class="p">(</span><span class="nb">name</span><span class="p">)</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">ensure_dependency_type!</span><span class="p">(</span><span class="n">dependency</span><span class="p">)</span>
      <span class="k">return</span> <span class="k">if</span> <span class="n">dependency</span><span class="p">.</span><span class="nf">respond_to?</span><span class="p">(</span><span class="ss">:call</span><span class="p">)</span>

      <span class="k">raise</span> <span class="no">TypeError</span><span class="p">,</span> <span class="s2">"dependency must be a Proc"</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">ensure_dependency_uniqueness!</span><span class="p">(</span><span class="nb">name</span><span class="p">)</span>
      <span class="k">return</span> <span class="k">unless</span> <span class="n">dependencies</span><span class="p">.</span><span class="nf">has_key?</span><span class="p">(</span><span class="nb">name</span><span class="p">)</span>

      <span class="n">record</span> <span class="o">=</span> <span class="n">dependencies</span><span class="p">.</span><span class="nf">fetch</span><span class="p">(</span><span class="nb">name</span><span class="p">)</span>
      <span class="k">raise</span> <span class="no">AlreadyRegisteredError</span><span class="p">.</span><span class="nf">new</span><span class="p">(</span><span class="nb">name</span><span class="p">),</span> <span class="n">registered</span><span class="p">(</span><span class="nb">name</span><span class="p">,</span> <span class="n">record</span><span class="p">)</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">registered</span><span class="p">(</span><span class="nb">name</span><span class="p">,</span> <span class="n">record</span><span class="p">)</span>
      <span class="n">registerer</span> <span class="o">=</span> <span class="n">record</span><span class="p">.</span><span class="nf">registerer</span>
      <span class="nb">format</span><span class="p">(</span><span class="no">AlreadyRegisteredError</span><span class="o">::</span><span class="no">MESSAGE</span><span class="p">,</span> <span class="nb">name</span><span class="p">.</span><span class="nf">to_s</span><span class="p">,</span> <span class="n">registerer</span><span class="p">.</span><span class="nf">to_s</span><span class="p">)</span>
    <span class="k">end</span>

    <span class="k">def</span> <span class="nf">missing</span><span class="p">(</span><span class="nb">name</span><span class="p">)</span>
      <span class="nb">format</span><span class="p">(</span><span class="no">DependencyMissingError</span><span class="o">::</span><span class="no">MESSAGE</span><span class="p">,</span> <span class="nb">name</span><span class="p">.</span><span class="nf">to_s</span><span class="p">)</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre></td></tr></tbody></table> </div> </div> <hr class="pagesplitter pagesplitter--solid-bar"> <footer class="article__section article__section--always-readable"> <a name=comments></a> <div id=disqus_thread></div> <div id=article_disqus_url>https://thehungry.dev/blog/2013-01-06/example-article</div> <div id=article_disqus_title>Example Article</div> <div id=article_disqus_identifier>/blog/2013-01-06/example-article</div> <script>

/**
*  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
*  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/

var disqus_config = function () {
this.page.url = document.getElementById("article_disqus_url").innerText;  // Replace PAGE_URL with your page's canonical URL variable
this.page.identifier = document.getElementById("article_disqus_identifier").innerText; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
};

(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');
s.src = 'https://thehungrydev.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script> <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript> </footer> </div> </article> </div> </div> </div> <script>
    window.RECAPTCHA_SITE_KEY = '6LfhE50UAAAAALSMOpl_sWrgdWapKLt-faa6RNXp';
    </script> <script src="https://www.google.com/recaptcha/api.js?render=6LfhE50UAAAAALSMOpl_sWrgdWapKLt-faa6RNXp"></script> <script id=dsq-count-scr src="//thehungrydev.disqus.com/count.js" async> </script> <script src="../../../javascripts/application-414d789c.js"></script> </body> </html>